<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>

<!-- TOC -->

- [多车同步运动 *位置控制* 公式（这里只写两个）](#多车同步运动-位置控制-公式这里只写两个)
    - [控制描述](#控制描述)
    - [相关定义](#相关定义)
    - [位置控制](#位置控制)
        - [1号车](#1号车)
        - [2号车](#2号车)
    - [同步控制](#同步控制)
        - [1号车与2号车分别如下](#1号车与2号车分别如下)
    - [公式最后形式](#公式最后形式)
        - [1号车](#1号车-1)
        - [2号车](#2号车-1)
- [多车同步运动 *速度控制* 公式（这里只写两个）](#多车同步运动-速度控制-公式这里只写两个)
    - [控制描述](#控制描述-1)
        - [公式最后的形式](#公式最后的形式)
        - [1号车](#1号车-2)
        - [2号车](#2号车-2)

<!-- /TOC -->


# 多车同步运动 *位置控制* 公式（这里只写两个）
位置控制 指的是 只控制车的位置。输入的数据是CAN通信传回的**位置**信息，不利用车的速度信息。返回的是车的目标位置信息。
位置是通过编码器的计算得到的，编码器和爬绳车（RCR） 的转换关系为：
$$  q = \eta * h $$
$$ \eta = \frac{\phi_{encoder}*\theta_{gear}}{S_{chain}*n} $$
1. $q$为编码器数值， $h$ 为位移
2. $\eta$ 为比例系数，编码器到位移的转换关系
3. 其中, $\phi_{encoder}$为编码器标称线数 1200, $\theta_{gear}$为减速比 40, $S_{chain}$为链轮长度 12.7mm, $n$为链条齿数 12.

**总结的**  $\eta = 563.38 \frac{线数}{mm}$

## 控制描述
1. 不像普通的AGV一样同步需要考虑多个自由度，AGV至少需要考虑拐弯。爬绳车（RCR）同步过程中需要考虑的就是两个车的高度差，通过 **高度差的反馈补偿** 就能实现，两个或多个车的同步。
2. 除了同步的高度差以外，还有每个车自身 **实际位置** 和 **目标位置** 的高度差，这个是运动的 **位置控制** 

## 相关定义
定义： 左边车为 1 号车； 右边车位2号车
p
1号车 同步的位置误差：
$$ \phi_1 = h_1 - h_2  $$
1号车 运动位置误差：
$$ \delta_1 = h_{d1} - h_1 $$

2号车 同步的位置误差：
$$ \phi_2 = h_2 - h_1  $$

2号车 运动位置误差：
$$ \delta_2 = h_{d2} - h_2 $$

## 位置控制
**简单的PI控制** 
### 1号车
$$  u_{11} = K_{p1}* \delta_1 + K_{i1} * \sum\delta_1(j)$$
1. $u_{11}$是1车的位置控制量
2. $\delta_1(j)$ 指的是1车第j次计算的误差值，当然实际上应该是积分，这里就用程序中实际的描述。
3. K_{p1} 和 K_{i1}是 常量， 需要调节

### 2号车
$$  u_{21} = K_{p2}* \delta_2 + K_{i2} * \sum\delta_2(j)$$
1. $u_{21}$是2车的位置控制量
2. $\delta_2(j)$ 指的是2车第j次计算的误差值，当然实际上应该是积分，这里就用程序中实际的描述。
3. $K_{p2}$ 和 $K_{i2}$ 是 常量， 需要调节


## 同步控制
简单的误差反馈就行
### 1号车与2号车分别如下
$$ u_{12} = K_{s1} * \phi_1 $$

$$ u_{22} = K_{s2} * \phi_2 $$
1. $u_{12}$是1车的同步控制量
2. $u_{22}$是2车的同步控制量

## 公式最后形式

### 1号车
$$ u_1 = u_{11} + u_{12} =  K_{p1}* \delta_1 + K_{i1} * \sum\delta_1(j) + K_{s1} * \phi_1 $$
$$ \delta_1 = p_{d1} - p_1 $$
$$ \phi_1 = h1 - h2  $$

### 2号车
$$ u_2 = u_{21} + u_{22} =  K_{p2}* \delta_1 + K_{i2} * \sum\delta_2(j) + K_{s2} * \phi_1 $$
$$ \delta_2 = p_{d2} - p_2 $$
$$ \phi_2 = h2 - h1  $$


# 多车同步运动 *速度控制* 公式（这里只写两个）
这里就同时利用can通信返回的**速度**和**位置**信息，返回的是给driver的速度信号. 
## 控制描述
这里使用的是滑膜控制。
滑膜控制的滑膜向量（sliding vector）为：
$$
s=\dot{ h}-\dot{ h}_r=\dot{ h}-\dot{ h}_d + K_p\delta + K_i\phi
$$
控制律：
$$
u_s=- K_s s-K_q\delta_1+({M}+ B)\ddot{q}_r+ D\dot{q}_r+ G
$$

这里，
1. $\dot{h}$和$\dot{h_d}$都是速度值，前面是can返回的速度，后面是计算的目标速度，这个速度就是，比如我在5m高，目标是7m，控制周期是100ms，这个速度就是$(7-5)/0.1=20m/s$ ,但是我们的车肯定是有速度上线的，如果期望速度超过上限值，就设置为上限值。
2. $K_p,K_q,K_i$ 这几项 可以和并起来，和前面位置控制的形式差不多。
3. 后面$M,B,D,G$ 是做 车的动力学补偿的，实际中不怎么用，只是$G$的部分我们是通过设置常数来补偿的，就是往上，加一个常数值$C_1$，往下,加另一个常数值$C_2$

### 公式最后的形式

### 1号车
$$ u_1 = -K_{s1}* (\dot{ h}_{1}-\dot{ h}_{d1} ) + K_{pq1}\delta_1 + K_{i1}\phi_1 + C_1 $$
$$ \delta_1 = h_{d1} - h_1 $$
$$ \phi_1 = h_1 - h_2  $$

### 2号车
$$ u_2 = -K_{s2}* (\dot{ h}_{2}-\dot{ h}_{d2} ) + K_{pq2}\delta_2 + K_{i2}\phi_2 + C_2 $$
$$ \delta_2 = h_{d2} - h_2 $$
$$ \phi_2 = h_2 - h_1  $$